# updatecli.yaml
name: "deps: update cluster-autoscaler version in input.tf"
scms:
  default:
    kind: "github"
    spec:
      user: "Akash Ughade"
      email: "akashughade77@gmail.com"
      owner: "akash911133"
      repository: "updatecli-PR"
      token: '{{ requiredEnv "UPDATECLI_GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "UPDATECLI_GITHUB_ACTOR" }}'
      branch: "main"
      commitmessage:
        hidecredit: true

actions:
  default:
    kind: "github/pullrequest"
    scmid: "default"
    spec:
      automerge: false
      draft: true
      labels: 
        - "dependencies"
      title: "Update git_repo_scanner helm chart version"

sources:
  chart-cluster-autoscaler:
    name: "Get the latest version of cluster-autoscaler helm chart"
    kind: "helmchart"
    spec:
      name: "cluster-autoscaler"
      url: "https://kubernetes.github.io/autoscaler"
      versionfilter:
        kind: "semver"
        pattern: "*"

targets:
  chart-cluster-autoscaler:
    name: 'deps: update cluster-autoscaler version in input.tf to {{ source "chart-cluster-autoscaler" }}'
    kind: "terraform/file"
    sourceid: "chart-cluster-autoscaler"
    scmid: "default"
    spec:
      file: "templates/eks/input.tf"
      path: "variable.CLUSTER_AUTOSCALER_HELM_CHART_VERSION.default"
